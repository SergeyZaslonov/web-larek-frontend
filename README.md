# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

##Данные
### Тип PaymentMethod
Тип PaymentMethod определяет способ оплаты
'cash'- Оплата при получении товара.
'online'- Оплата банковской картой.
```
type PaymentMethod = 'cash' | 'online' | undefined
```

### Интерфейс товара IProduct
Определяет  характеристики товара (идентификатор, заголовок, категорию, описание, изображение, цену)
```
IProduct {
  id: string;                   // идентификатор
  category: TProductCategory;   // категория
  title: string;                // наименование
  description: string;          // описание
  image: string;                // картинка
  price: number | null;
}
```
### Интерфейс корзины IBasket
Хранит товары в корзине (список идентификаторов товаров и общая сумма заказа)
```
interface IBasket {
  items[]: string;              // покупки
  total: number;                // итоговая сумма
}
```

### Интерфейс IOrderInfo информация о заказе
Хранит информацию о методе оплаты, email, телефон заказчика и адрес доставки;
```
interface IOrderInfo {
	payment: PaymentMethod;
	email: string;
	phone: string;
	address: string;
}
```

### Интерфейс заказа IOrder
Объединение информации о заказе и корзины с товарами, используется для передачи данных о заказе на сервер
```
export interface IOrder extends IOrderInfo {
  items: string[];
  total: number;
}
```

### Интерфейс IOrderResult
Данные возвращаемые сервером при успешном размещении заказа
```
interface IOrderResult {
	id: string;
	total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой данных, отвечает за хранение и изменение данных
- слой представления, отвечает за отображение данных на странице, 
- презентер, отвечает за связь представления и данных.

## Базовый код
### Базовый класс API
Базовый класс API реализует базовые функции работы с сервером, запросы на сервер и обработку ответов.

Тип ApiPostMethods определяет тип запроса к серверу на изменение данных.
```
 type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
``` 
#### Конструктор
** constructor(baseUrl: string, options: RequestInit = {}) **
- **baseUrl** – базовый адрес для запроса на сервер;
- **options** – опции запроса, по умолчанию пустой объект.
#### Методы
Запрос на получение данных с сервера (GET).

- **get(uri: string)**
uri – относительный адрес запроса

Запрос на передачу или изменение данных на сервере

- **post(uri: string, data: object, method: ApiPostMethods)**
uri – относительный адрес запроса,
data – данные для передачи на сервер,
method – тип запроса к серверу на изменение данных (POST, PUT или DELETE), по умолчанию 'POST'.

Обработка ответа от сервера

- **handleResponse(response: Response)**
response: Объект, представляющий ответ от сервера.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Базовый абстрактный класс для отображения Component
Базовый класс от которого наследуются все объекты слоя представления.
#### Конструктор
Создаёт новый объект Component, в переданном HTML элементе (контейнере).
- **constructor(container: HTMLElement)**
#### Методы
Переключить класс `className` у элемента `element`
- **toggleClass(element: HTMLElement, className: string, force?: boolean)**

Установить текстовое содержимое `value` для `element` 
- **setText(element: HTMLElement, value: unknown)**

Сменить статус блокировки (disabled) для `element`
- **setDisabled(element: HTMLElement, state: boolean)**

Скрыть `element` 
- **setHidden(element: HTMLElement)**

Показать `element` 
- **setVisible(element: HTMLElement)**

Установить изображение `src` с альтернативным текстом `alt` (опционально) в `element` 
- **setImage(element: HTMLImageElement, src: string, alt?: string)**

Генерирует DOM-элемент на основе переданных данных в параметре `data` и отобрает данные в компоненте
- **render(data?: Partial<T>): HTMLElement**

### Базовый класс Form  
Базовый класс для управления формами, основан на базовом классе Component.\
Дополняет класс Component функциями обработки ввода пользователей и отображения ошибок ввода. 
#### Конструктор
Создает новый экземпляр класса Form, принимает `content` контейнер для вывода содержимого окна и `events` экземпляр объекта брокера событий.
- **constructor(container: HTMLFormElement, events: IEvents):** 
#### Методы
- **onInputChange(field: keyof T, value: string)** Метод вызывается при изменении значения в поле ввода. Вызывает событие `change` и передаёт информацию название контейнера, название поля и его значение.
- **set valid(value: boolean)** Установить доступность кнопки отправки формы.
- **set errors(value: string):** Отобразить сообщение об ошибке на форме.
- **render(state: Partial<T> & IFormState):** Отобразить текущее состояние формы

### Класс Modal
Служит контейнером для отображения различных модальных окон, принимает `content` для вывода содержимого окна и `events` экземпляр объекта брокера событий. Класс обеспечивает базовые функции открытия/закрытия модального окна. Наследуется от  класса Component.
#### Конструктор
Создает новый экземпляр класса Modal.
- **constructor(container: HTMLElement, events: IEvents):** Создает новый экземпляр класса Modal, принимая DOM элемент контейнера модального окна и объект IEvents для обработки событий.
#### Методы
- **open():** Открывает модальное окно и вызывает событие `modal:open`.
- **close():** Закрывает модальное окно и вызывает событие `modal:close`.
- **render(data: IModalData):** Отображает содержимое модального окна и открывает его.

## Данные
### Модель данных класс LarekModel
Класс отвечает за хранение и логику работы с данными 
#### Конструктор
Создает новый экземпляр класса LarekModel, принимает `events` экземпляр объекта брокера событий.
- **constructor(protected events: IEvents)** 
#### Поля
- **catalog: IProduct\[\]** – Каталог товаров, массив объектов IProduct;
- **basket: string\[\]** – Товары в корзине, массив строк содержащих `id` товаров;
- **order: IOrder** – Информация о заказе, объект IOrder;
- **formErrors: string** – Ошибки при вводе пользователем информации о заказе;
#### Методы
- **setCatalog** – Заполняет каталог товарами, вызывает событие изменение каталога товаров `catalog-changed`;
- **getProduct(id: string):IProduct** – Возвращает товар из каталога по `id`;
- **addToBasket(id: string)** – Добавляет товар с `id` в корзину, вызывает событие `product:add`;
- **removeFromBasket(id: string)** – Удаляет товар с `id` из корзины, вызывает событие `product-remove`;
- **productInBasket(id:string):boolean** – Проверяет есть ли товар с `id` в корзине;
- **basketCount():number** – количество товаров в корзине;
- **basketTotal():number** – общая сумма за товары в корзине;
- **clearBasket()** - очищает корзину, вызывает событие `product-remove`;
- **checkPaymentMethodAndAddress():boolean** – проверяет корректность ввода метода оплаты и адреса; 
- **checkEmailAndPhone():boolean** – проверяет корректность ввода электронной почты и телефона; 

## Отображение
### Класс Page окно отображения основной страницы
Расширяет базовый класс Component, отображает основную главную страницу.\
#### Поля объекта
- **items: HTMLElement[]** – каталог товаров;
- **basketCount: number** – число товаров в корзине;
#### Конструктор
**constructor(container: HTMLElement, events: IEvents)**\
В конструктор передаётся HTML контейнер, экземпляр объекта брокера событий.\
В конструкторе находятся элементы HTML разметки (контейнер каталога товаров, кнопка корзины, элемент отображения количества товаров в корзине), устанавливается обработчик нажатия кнопки "Корзина" (`basket:open`).

### Класс Card – класс для отображения карточки товара
Расширяет базовый класс Component, служит для отображения товара.
#### Конструктор
**constructor(container: HTMLElement, product: IProduct, events: IEvents)** \
В конструктор передаётся HTML контейнер, экземпляр объекта брокера событий и данные карточки.\
В конструкторе находим соответствие между элементами HTML разметки и полями IProduct, устанавливается текстовое содержимое для найденных элементов. Устанавливается событие нажатия на кнопку в зависимости от наличия товара в корзине.

### Класс Basket – класс для отображения состава корзины
Расширяет базовый класс Form, служит для отображения и редактирования состава заказа/корзины.
#### Конструктор
**constructor(container: HTMLElement, basket: IBasket, events: IEvents)**\
В конструктор передаётся HTML контейнер, экземпляр объекта брокера событий и объект корзины с товарами.\
В конструкторе создаётся отображаемый список товаров из корзины из элементов Card, создаются обработчики событий пользовательского интерфейса.

### Класс OrderForm – класс для отображения и редактирования данных заказа
Расширяет базовый класс Form, класс для отображения и редактирования данных заказа о методе оплаты и адресе. Реализует функционал форм для редактирования данных заказа, прослушивание изменений в полях ввода, проверку данных введенных данных, отображение ошибок, переключение доступности кнопки, перехода на следующий шаг.
#### Конструктор
**constructor(container: HTMLElement, order: IOrderInfo, events: IEvents)**\
В конструкторе находятся элементы HTML разметки в соответствии с полями IOrderInfo, устанавливается текстовое содержимое для найденных элементов, устанавливается сообщение о изменении содержимого элементов редактирования.

### Класс Contacts – класс для отображения и редактирования данных заказа
Расширяет базовый класс Form, класс для отображения и редактирования данных заказа о электронной почте и телефоне. Реализует функционал форм для редактирования данных заказа, прослушивание изменений в полях ввода, проверку данных введенных данных, отображение ошибок, переключение доступности кнопки, перехода на следующий шаг.
#### Конструктор
**constructor(container: HTMLElement, order: IOrderInfo, events: IEvents)**\
В конструкторе находятся элементы HTML разметки в соответствии с полями IOrderInfo, устанавливается текстовое содержимое для найденных элементов, устанавливается сообщение о изменении содержимого элементов редактирования.

### Класс Success – класс для отображения информации о подтверждении заказа
Расширяет базовый класс Form.
#### Конструктор
**constructor(container: HTMLElement, order: IOrderInfo, events: IEvents)** \
В конструкторе находятся элементы HTML разметки в соответствии с полями IOrderResult, устанавливается текстовое содержимое для найденных элементов.

## Слой коммуникации API
### Класс LarekAPI
Расширяет базовый класс API и дополняет его методами
- получения списка товаров
- получение информации по товару по его идентификатору товара
- отправки корзины с товарами на сервер
#### Поля
**cdn: string:** относительный адрес для загрузки изображений товаров.
#### Конструктор
**constructor(baseUrl: string, cdn: string, options?: RequestInit)**
- **baseUrl** – базовый адрес для запроса на сервер;
- **cdn: string:** относительный адрес для загрузки изображений товаров.
- **options** – опции запроса, по умолчанию пустой объект.
#### Методы
Запрос на получение списка товаров с сервера
- **getProductsList(): Promise\<IProduct\[\]\>** возвращает Promise с массивом объектов IProduct.

Запрос на получение информации с сервера о товаре по его идентификатору
- **getProductItem(id: string): Promise\<IProduct\>** возвращает Promise с объектом IProduct.

Запрос отправляющий данные заказа на сервер
- **putOrder(order: IOrderForm): Promise\<IOrderResult\>** возвращает Promise с объектом IOrderResult, представляющий подтверждение размещения заказа.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Список событий генерируемых в системе
**catalog.changed**
Происходит при изменении состава каталога товаров. При возникновении события, создаются новые карточки товаров, обновляется корзина в соответствии с новым каталогом.

**product:add**
Происходит при нажатии кнопки "В корзину". При возникновении события, выбранный товар (`id` товара) помещается в корзину.

**product:remove**
Происходит при нажатии кнопки "Удалить" из корзины. При возникновении события, выбранный товар по `id` удаляется из корзины.

**basket:changed**
Происходит при изменении корзины. При возникновении события, определяются количество товаров в корзине и их стоимость.

**modal:open**
Происходит при открытии модального окна. При возникновении события, блокируется основная страница.

**modal:close**
Происходит при закрытии модального окна. При возникновении события, разблокируется основная страница.

**card:select**
Происходит при выборе карточки товара. При возникновении события, открывается модальное окно с карточкой товара (preview).

**basket:open**
Происходит при нажатии кнопки "Корзина". При возникновении события, открывается модальное окно "Корзина" с содержимым корзины.

**basket:refresh**
Происходит при нажатии кнопки "Удалить" в модальном окне "Корзина". При возникновении события, обновляется список товаров в окне "Корзина".

**order:open**
Происходит при нажатии кнопки "Оформить" в модальном окне "Корзина". При возникновении события, открывается модальное окно с выбором способа оплаты и адресом доставки.

**order.\*:change**
Происходит при изменении информации о заказе в форме с вводом метода оплаты и адреса получателя(в названии события вместо звёздочки передается название изменённого поля).

**order:next**
Происходит при нажатии кнопки "Далее" в модальном окне с выбором способа оплаты и адресом доставки. При возникновении события, открывается модальное окно с вводом электронной почты и телефона.

**contacts.\*:change**
Происходит при изменении информации о заказе в форме с вводом электронной почты и телефона (в названии события вместо звёздочки передается название изменённого поля).

**order:pay**
Происходит при нажатии кнопки "Оплатить" в модальном окне с вводом электронной почты и телефона. При возникновении события, данные заказа отправляются на сервер, обрабатывается ответ сервера и в случае успешного выполнения запроса открывается модальное окно с подтверждением заказа.

**order:finish**
Происходит при закрытии окна с подтверждением заказа. При возникновении события, корзина очищается.

**order:changed**
Происходит при изменении данных о заказе в модели. При возникновении события, проверяются данные заказа на корректность и по результату разрешается переход на следующий шаг или выводится сообщение об ошибке.


